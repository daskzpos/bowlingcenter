<!DOCTYPE html>
<html lang="nl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Banen Overzicht - Brooklyn Bowl</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-900">
  <!-- Navigation bar -->
  <nav class="bg-black bg-opacity-80 backdrop-blur-lg shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-16">
        <!-- Logo/Titel -->
        <div class="flex items-center gap-3">
          <h1 class="text-white text-2xl font-bold">Brooklyn Bowl</h1>
          <span class="bg-orange-600 text-white text-xs px-3 py-1 rounded-full font-semibold">
            WERK/DIR
          </span>
        </div>

        <!-- Rechts: terug naar directie dashboard + uitloggen -->
        <div class="flex items-center gap-4">
          <a href="/pages/dashboardMedewerker.html" class="text-gray-300 hover:text-white text-sm">
            ‚Üê Terug naar dashboard
          </a>
          <a href="login.html"
            class="bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-orange-700 transition">
            Uitloggen
          </a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main content -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Titel / hero -->
    <div
      class="bg-gradient-to-r from-orange-600 to-orange-500 rounded-2xl p-8 mb-8 shadow-xl flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div>
        <h2 class="text-white text-4xl font-bold mb-2">
          Banen overzicht üé≥
        </h2>
        <p class="text-white text-lg">
          Bekijk de beschikbaarheid en status van alle banen.
        </p>
      </div>
      <div class="mt-4 md:mt-0 text-white text-sm md:text-right">
        <p class="font-semibold">Brooklyn Bowl</p>
        <p>Vandaag: <span id="today" class="font-mono"></span></p>
      </div>
    </div>

    <!-- Filter & datum selectie -->
    <div
      class="bg-gray-800 rounded-2xl p-6 shadow-lg mb-8 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full md:w-auto">
        <div>
          <label for="date" class="block text-gray-300 text-sm mb-1">Datum</label>
          <input id="date" type="date"
            class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-500" />
        </div>
        <div>
          <label for="time-slot" class="block text-gray-300 text-sm mb-1">Tijdsblok</label>
          <select id="time-slot"
            class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-500">
            <option>Alle tijden</option>
            <option>12:00 - 14:00</option>
            <option>14:00 - 16:00</option>
            <option>16:00 - 18:00</option>
            <option>18:00 - 20:00</option>
            <option>20:00 - 22:00</option>
          </select>
        </div>
        <div>
          <label for="status-filter" class="block text-gray-300 text-sm mb-1">Status</label>
          <select id="status-filter"
            class="w-full px-4 py-2 rounded-lg bg-gray-900 text-white border border-gray-700 focus:outline-none focus:ring-2 focus:ring-orange-500">
            <option>Alle banen</option>
            <option>Beschikbaar</option>
            <option>Gereserveerd</option>
            <option>Bezet (walk-in)</option>
            <option>Onderhoud</option>
          </select>
        </div>
      </div>

      <div class="flex gap-3 justify-end">
        <button id="reset-btn"
          class="px-4 py-2 rounded-lg border border-gray-600 text-gray-200 text-sm font-semibold hover:bg-gray-700 transition">
          Reset filters
        </button>
        <button id="apply-btn"
          class="px-6 py-2 rounded-lg bg-orange-600 text-white text-sm font-semibold hover:bg-orange-700 transition">
          Toepassen
        </button>
      </div>
    </div>

    <!-- Legenda -->
    <div class="bg-gray-800 rounded-2xl p-4 shadow-lg mb-6 flex flex-wrap gap-4 items-center">
      <span class="text-white font-semibold mr-2">Legenda:</span>
      <div class="flex items-center gap-2 text-sm text-gray-200">
        <span class="w-4 h-4 rounded-full bg-green-500"></span> Beschikbaar
      </div>
      <div class="flex items-center gap-2 text-sm text-gray-200">
        <span class="w-4 h-4 rounded-full bg-yellow-400"></span> Gereserveerd
      </div>
      <div class="flex items-center gap-2 text-sm text-gray-200">
        <span class="w-4 h-4 rounded-full bg-red-500"></span> Bezet
      </div>
      <div class="flex items-center gap-2 text-sm text-gray-200">
        <span class="w-4 h-4 rounded-full bg-gray-500"></span> Onderhoud
      </div>
    </div>

    <!-- Grid met banen -->
    <div id="lanes-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-10">
      <!-- Lanes will be loaded dynamically -->
      <p class="text-gray-400 text-center py-8 col-span-4">Banen worden geladen...</p>
    </div>

  </div>

  <script>
    // Vandaag tonen
    const todayEl = document.getElementById("today");
    if (todayEl) {
      const today = new Date();
      todayEl.textContent = today.toLocaleDateString("nl-NL", {
        weekday: "long",
        day: "2-digit",
        month: "long",
        year: "numeric",
      });
    }
    
    // Set default date to today
    const dateInput = document.getElementById('date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.value = today;
    
    // Load lanes data with filters
    async function loadLanes() {
      const lanesGrid = document.getElementById('lanes-grid');
      const selectedDate = document.getElementById('date').value;
      const selectedTimeSlot = document.getElementById('time-slot').value;
      const selectedStatus = document.getElementById('status-filter').value;
      
      if (!selectedDate) {
        lanesGrid.innerHTML = '<p class="text-gray-400 text-center py-8 col-span-4">Selecteer een datum</p>';
        return;
      }
      
      lanesGrid.innerHTML = '<p class="text-gray-400 text-center py-8 col-span-4">Banen worden geladen...</p>';
      
      try {
        // Fetch lane availability for the selected date and time
        const response = await fetch('/php/getLaneAvailability.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            date: selectedDate,
            time_slot: selectedTimeSlot
          })
        });
        
        const data = await response.json();
        
        if (data.success) {
          let lanes = data.lanes;
          
          // Apply status filter
          if (selectedStatus !== 'Alle banen') {
            const statusMap = {
              'Beschikbaar': 'available',
              'Gereserveerd': 'reserved',
              'Bezet (walk-in)': 'occupied',
              'Onderhoud': 'maintenance'
            };
            const filterStatus = statusMap[selectedStatus];
            if (filterStatus) {
              lanes = lanes.filter(lane => lane.status === filterStatus);
            }
          }
          
          if (lanes.length === 0) {
            lanesGrid.innerHTML = '<p class="text-gray-400 text-center py-8 col-span-4">Geen banen gevonden met de geselecteerde filters</p>';
            return;
          }
          
          const statusColors = {
            available: 'bg-green-500',
            reserved: 'bg-yellow-400',
            occupied: 'bg-red-500',
            maintenance: 'bg-gray-500'
          };
          
          const statusLabels = {
            available: 'Beschikbaar',
            reserved: 'Gereserveerd',
            occupied: 'Bezet',
            maintenance: 'Onderhoud'
          };
          
          lanesGrid.innerHTML = lanes.map(lane => {
            let nextReservationInfo = 'Geen';
            if (lane.next_reservation) {
              nextReservationInfo = `${lane.next_reservation.start_time.substring(0,5)} - ${lane.next_reservation.end_time.substring(0,5)}`;
              if (lane.next_reservation.customer_name) {
                nextReservationInfo += ` (${lane.next_reservation.customer_name})`;
              }
            }
            
            return `
              <div class="bg-gray-800 rounded-xl p-4 shadow-lg flex flex-col gap-3">
                <div class="flex items-center justify-between">
                  <h3 class="text-white text-xl font-bold">Baan ${lane.lane_number}${lane.is_child_lane ? ' üë∂' : ''}</h3>
                  <span class="w-3 h-3 rounded-full ${statusColors[lane.status]}"></span>
                </div>
                <p class="text-gray-400 text-sm">Status: ${statusLabels[lane.status]}</p>
                ${lane.is_child_lane ? '<p class="text-purple-400 text-xs">Kinderbaan met bumpers</p>' : ''}
                <p class="text-gray-400 text-sm">
                  Volgende reservering: <span class="text-gray-300">${nextReservationInfo}</span>
                </p>
                <button
                  class="mt-2 w-full bg-orange-600 text-white py-2 rounded-lg text-sm font-semibold hover:bg-orange-700 transition"
                  onclick="window.location.href='/pages/werkdirReserveer.html'">
                  Reservering inplannen
                </button>
              </div>
            `;
          }).join('');
        } else {
          lanesGrid.innerHTML = '<p class="text-red-400 text-center py-8 col-span-4">Fout bij laden: ' + data.message + '</p>';
        }
      } catch (error) {
        console.error('Error loading lanes:', error);
        lanesGrid.innerHTML = '<p class="text-red-400 text-center py-8 col-span-4">Fout bij laden van banen</p>';
      }
    }
    
    // Apply filters button
    document.getElementById('apply-btn').addEventListener('click', loadLanes);
    
    // Reset filters button
    document.getElementById('reset-btn').addEventListener('click', () => {
      document.getElementById('date').value = today;
      document.getElementById('time-slot').value = 'Alle tijden';
      document.getElementById('status-filter').value = 'Alle banen';
      loadLanes();
    });
    
    // Load lanes on page load
    loadLanes();
  </script>
</body>

</html>